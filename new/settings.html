<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings â€” Job Notification Tracker</title>
  <link rel="stylesheet" href="kodnest-design-system/tokens.css">
  <link rel="stylesheet" href="kodnest-design-system/base.css">
  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="layout">
    <nav class="app-nav">
      <a href="index.html" class="app-nav-brand">Job Notification Tracker</a>
      <div class="app-nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="saved.html">Saved</a>
        <a href="digest.html">Digest</a>
        <a href="settings.html" class="active">Settings</a>
        <a href="proof.html">Proof</a>
      </div>
    </nav>
    <main class="app-main">
      <h1>Settings</h1>
      <p style="margin-bottom: var(--space-lg);">Configure your job preferences.</p>
      <div class="card" style="max-width: 560px;">
        <form id="preferences-form">
          <div class="form-group">
            <label for="roleKeywords">Role keywords (comma-separated)</label>
            <input type="text" id="roleKeywords" class="input" placeholder="e.g. Frontend Developer, SDE, React">
          </div>
          <div class="form-group">
            <label for="preferredLocations">Preferred locations</label>
            <select id="preferredLocations" class="input" multiple size="4">
              <option value="Bangalore">Bangalore</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Hyderabad">Hyderabad</option>
              <option value="Pune">Pune</option>
              <option value="Chennai">Chennai</option>
              <option value="Delhi NCR">Delhi NCR</option>
              <option value="Gurgaon">Gurgaon</option>
              <option value="Noida">Noida</option>
            </select>
            <span class="form-hint">Hold Ctrl/Cmd to select multiple</span>
          </div>
          <div class="form-group">
            <label>Preferred mode</label>
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" name="preferredMode" value="Remote"> Remote</label>
              <label class="checkbox-label"><input type="checkbox" name="preferredMode" value="Hybrid"> Hybrid</label>
              <label class="checkbox-label"><input type="checkbox" name="preferredMode" value="Onsite"> Onsite</label>
            </div>
          </div>
          <div class="form-group">
            <label for="experienceLevel">Experience level</label>
            <select id="experienceLevel">
              <option value="">Select</option>
              <option value="Fresher">Fresher</option>
              <option value="0-1">0-1 years</option>
              <option value="1-3">1-3 years</option>
              <option value="3-5">3-5 years</option>
            </select>
          </div>
          <div class="form-group">
            <label for="skills">Skills (comma-separated)</label>
            <input type="text" id="skills" class="input" placeholder="e.g. React, Java, Python">
          </div>
          <div class="form-group">
            <label for="minMatchScore">Minimum match threshold: <span id="minMatchScoreValue">40</span>%</label>
            <input type="range" id="minMatchScore" min="0" max="100" value="40" class="slider">
          </div>
          <button type="submit" class="btn btn-primary">Save preferences</button>
        </form>
      </div>
    </main>
  </div>

  <script src="app.js"></script>
  <script>
    (function() {
      const form = document.getElementById('preferences-form');
      const minMatchSlider = document.getElementById('minMatchScore');
      const minMatchValue = document.getElementById('minMatchScoreValue');

      minMatchSlider.addEventListener('input', function() {
        minMatchValue.textContent = this.value;
      });

      const prefs = getPreferences();
      if (prefs) {
        document.getElementById('roleKeywords').value = prefs.roleKeywords || '';
        document.getElementById('experienceLevel').value = prefs.experienceLevel || '';
        document.getElementById('skills').value = prefs.skills || '';
        minMatchSlider.value = prefs.minMatchScore ?? 40;
        minMatchValue.textContent = minMatchSlider.value;

        const locSelect = document.getElementById('preferredLocations');
        const locs = prefs.preferredLocations || [];
        for (let i = 0; i < locSelect.options.length; i++) {
          locSelect.options[i].selected = locs.includes(locSelect.options[i].value);
        }

        const modeChecks = document.querySelectorAll('input[name="preferredMode"]');
        const modes = prefs.preferredMode || [];
        modeChecks.forEach(cb => { cb.checked = modes.includes(cb.value); });
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const locSelect = document.getElementById('preferredLocations');
        const selectedLocs = [];
        for (let i = 0; i < locSelect.options.length; i++) {
          if (locSelect.options[i].selected) selectedLocs.push(locSelect.options[i].value);
        }
        const modeChecks = document.querySelectorAll('input[name="preferredMode"]:checked');
        const selectedModes = Array.from(modeChecks).map(cb => cb.value);

        const prefs = {
          roleKeywords: document.getElementById('roleKeywords').value.trim(),
          preferredLocations: selectedLocs,
          preferredMode: selectedModes,
          experienceLevel: document.getElementById('experienceLevel').value,
          skills: document.getElementById('skills').value.trim(),
          minMatchScore: parseInt(minMatchSlider.value, 10) || 40
        };

        if (savePreferences(prefs)) {
          alert('Preferences saved.');
        }
      });
    })();
  </script>
</body>
</html>
