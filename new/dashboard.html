<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard â€” Job Notification Tracker</title>
  <link rel="stylesheet" href="kodnest-design-system/tokens.css">
  <link rel="stylesheet" href="kodnest-design-system/base.css">
  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="layout">
    <nav class="app-nav">
      <a href="index.html" class="app-nav-brand">Job Notification Tracker</a>
      <div class="app-nav-links">
        <a href="dashboard.html" class="active">Dashboard</a>
        <a href="saved.html">Saved</a>
        <a href="digest.html">Digest</a>
        <a href="settings.html">Settings</a>
        <a href="proof.html">Proof</a>
      </div>
    </nav>
    <main class="app-main">
      <h1>Jobs</h1>
      <p style="margin-bottom: var(--space-md);">Browse and save jobs that match your interests.</p>

      <div id="prefs-banner" class="prefs-banner card" style="display: none;">
        <p style="margin: 0;">Set your preferences to activate intelligent matching.</p>
        <a href="settings.html" class="btn btn-primary btn-sm" style="margin-top: var(--space-sm);">Go to Settings</a>
      </div>

      <div class="filter-bar">
        <input type="text" id="filter-keyword" placeholder="Search by title or company" class="filter-keyword">
        <select id="filter-location">
          <option value="">All locations</option>
        </select>
        <select id="filter-mode">
          <option value="">All modes</option>
          <option value="Remote">Remote</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Onsite">Onsite</option>
        </select>
        <select id="filter-experience">
          <option value="">All experience</option>
          <option value="Fresher">Fresher</option>
          <option value="0-1">0-1</option>
          <option value="1-3">1-3</option>
          <option value="3-5">3-5</option>
        </select>
        <select id="filter-source">
          <option value="">All sources</option>
          <option value="LinkedIn">LinkedIn</option>
          <option value="Naukri">Naukri</option>
          <option value="Indeed">Indeed</option>
        </select>
        <select id="filter-status">
          <option value="">All</option>
          <option value="Not Applied">Not Applied</option>
          <option value="Applied">Applied</option>
          <option value="Rejected">Rejected</option>
          <option value="Selected">Selected</option>
        </select>
        <select id="filter-sort">
          <option value="latest">Latest first</option>
          <option value="oldest">Oldest first</option>
          <option value="match">Match score</option>
          <option value="salary">Salary</option>
          <option value="company">By company</option>
        </select>
      </div>

      <div class="toggle-bar">
        <label class="toggle-label">
          <input type="checkbox" id="filter-match-only">
          <span>Show only jobs above my threshold</span>
        </label>
        <button type="button" id="filter-clear-all" class="btn btn-secondary btn-sm">Clear All</button>
      </div>

      <div id="job-cards-container" class="job-cards"></div>
      <div id="empty-state" class="empty-state" style="display: none;">
        <h2>No roles match your criteria.</h2>
        <p>Adjust filters or lower threshold.</p>
      </div>
    </main>
  </div>

  <div id="job-modal-overlay" class="modal-overlay">
    <div id="job-modal-content" class="modal-content"></div>
  </div>

  <script src="jobs-data.js"></script>
  <script src="app.js"></script>
  <script>
    (function() {
      const container = document.getElementById('job-cards-container');
      const emptyState = document.getElementById('empty-state');
      const prefsBanner = document.getElementById('prefs-banner');

      const locationSelect = document.getElementById('filter-location');
      const locations = [...new Set(JOBS_DATA.map(j => j.location))].sort();
      locations.forEach(loc => {
        const opt = document.createElement('option');
        opt.value = loc;
        opt.textContent = loc;
        locationSelect.appendChild(opt);
      });

      function getFilters() {
        return {
          keyword: document.getElementById('filter-keyword').value.trim(),
          location: document.getElementById('filter-location').value,
          mode: document.getElementById('filter-mode').value,
          experience: document.getElementById('filter-experience').value,
          source: document.getElementById('filter-source').value,
          status: document.getElementById('filter-status').value,
          sort: document.getElementById('filter-sort').value
        };
      }

      function render() {
        const prefs = getPreferences();
        prefsBanner.style.display = prefs ? 'none' : 'block';

        const filters = getFilters();
        const filterMatchOnly = document.getElementById('filter-match-only').checked;

        const jobsWithScore = JOBS_DATA.map(j => {
          const copy = { ...j };
          copy._matchScore = computeMatchScore(j, prefs);
          return copy;
        });

        const jobs = filterAndSortJobs(jobsWithScore, filters, {
          filterByMatchScore: filterMatchOnly && prefs,
          preferences: prefs,
          minMatchScore: prefs ? (prefs.minMatchScore ?? 40) : 0
        });

        if (jobs.length === 0) {
          container.style.display = 'none';
          emptyState.style.display = 'block';
          emptyState.querySelector('h2').textContent = 'No roles match your criteria.';
          emptyState.querySelector('p').textContent = 'Adjust filters or lower threshold.';
        } else {
          container.style.display = 'flex';
          emptyState.style.display = 'none';
          initJobCards(container, jobs, {
            showSave: true,
            showUnsave: false,
            showMatchScore: !!prefs
          });
        }
      }

      let debounceTimer;
      document.getElementById('filter-keyword').addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(render, 150);
      });
      document.getElementById('filter-location').addEventListener('change', render);
      document.getElementById('filter-mode').addEventListener('change', render);
      document.getElementById('filter-experience').addEventListener('change', render);
      document.getElementById('filter-source').addEventListener('change', render);
      document.getElementById('filter-status').addEventListener('change', render);
      document.getElementById('filter-sort').addEventListener('change', render);
      document.getElementById('filter-match-only').addEventListener('change', render);

      document.getElementById('filter-clear-all').addEventListener('click', function() {
        document.getElementById('filter-keyword').value = '';
        document.getElementById('filter-location').value = '';
        document.getElementById('filter-mode').value = '';
        document.getElementById('filter-experience').value = '';
        document.getElementById('filter-source').value = '';
        document.getElementById('filter-status').value = '';
        document.getElementById('filter-sort').value = 'latest';
        document.getElementById('filter-match-only').checked = false;
        render();
      });

      render();
    })();
  </script>
</body>
</html>
